<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Review Your Quote - Terminus Industrials" />
    <title>Review Your Quote - Terminus Industrials</title>

    <!-- Critical CSS to prevent white flash -->
    <style>
      html,
      body {
        background-color: #0a0f0e;
        margin: 0;
        padding: 0;
      }
    </style>

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Mono:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid rgba(105, 255, 194, 0.2);
      }

      .review-title {
        font-family: "Roboto Mono", monospace;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--brand-cyan);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .review-id {
        font-family: "Roboto Mono", monospace;
        font-size: 0.9rem;
        color: var(--brand-light-gray);
        background: rgba(105, 255, 194, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 4px;
      }

      .review-actions {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .btn {
        font-family: "Roboto Mono", monospace;
        font-size: 0.9rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-edit {
        background: transparent;
        border: 2px solid var(--brand-cyan);
        color: var(--brand-cyan);
      }

      .btn-edit:hover {
        background: var(--brand-cyan);
        color: #0a0f0e;
        box-shadow: 0 0 20px rgba(105, 255, 194, 0.3);
      }

      .btn-confirm {
        background: var(--brand-cyan);
        border: 2px solid var(--brand-cyan);
        color: #0a0f0e;
        box-shadow: 0 0 15px rgba(105, 255, 194, 0.2);
      }

      .btn-confirm:hover {
        box-shadow: 0 0 25px rgba(105, 255, 194, 0.5);
        transform: translateY(-2px);
      }

      .review-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: rgba(105, 255, 194, 0.02);
        border: 1px solid rgba(105, 255, 194, 0.15);
        border-radius: 8px;
      }

      .review-section-title {
        font-family: "Roboto Mono", monospace;
        font-size: 1rem;
        font-weight: 700;
        color: var(--brand-cyan);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(105, 255, 194, 0.1);
      }

      .review-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }

      .review-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .review-label {
        font-family: "Roboto", sans-serif;
        font-size: 0.8rem;
        font-weight: 700;
        color: var(--brand-light-gray);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .review-value {
        font-family: "Roboto", sans-serif;
        font-size: 1rem;
        color: var(--brand-white);
        padding: 0.5rem 0.75rem;
        background: rgba(10, 15, 14, 0.5);
        border-radius: 4px;
        border-left: 3px solid rgba(105, 255, 194, 0.3);
        min-height: 2.5rem;
        display: flex;
        align-items: center;
        cursor: default;
        user-select: none;
      }

      .review-value.empty {
        color: rgba(207, 217, 214, 0.4);
        font-style: italic;
      }

      .review-value.list {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .review-value .tag {
        display: inline-block;
        background: rgba(105, 255, 194, 0.15);
        color: var(--brand-cyan);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
        margin: 0.125rem 0;
      }

      .review-item.full-width {
        grid-column: 1 / -1;
      }

      .not-found {
        text-align: center;
        padding: 4rem 2rem;
      }

      .not-found h2 {
        font-family: "Roboto Mono", monospace;
        font-size: 1.5rem;
        color: var(--brand-cyan);
        margin-bottom: 1rem;
      }

      .not-found p {
        font-family: "Roboto", sans-serif;
        color: var(--brand-gray);
        margin-bottom: 2rem;
      }

      @media (max-width: 768px) {
        .review-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .review-actions {
          flex-direction: column;
          width: 100%;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .review-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="logo-container">
        <a href="/">
          <img src="/public/logo.svg" alt="Terminus Logo" class="logo" />
        </a>
      </div>
      <div class="nav-links">
        <a href="/receive-instant-quote" class="nav-link">Receive Instant Quote</a>
      </div>
    </nav>

    <!-- Page Content -->
    <main class="form-page-container">
      <div class="form-wrapper" id="reviewContent">
        <!-- Content will be injected by JavaScript -->
      </div>
    </main>

    <script>
      // Field labels for display
      const fieldLabels = {
        companyName: 'Company Name',
        projectName: 'Project / Site Name',
        siteAddress: 'Site Address / GPS Coordinates',
        contactName: 'Primary Contact Name',
        contactEmail: 'Email',
        contactPhone: 'Phone',
        hvRating: 'High-Voltage Rating (kV)',
        lvRating: 'Low-Voltage Rating (kV)',
        mvaRating: 'MVA Rating (continuous)',
        frequency: 'Frequency',
        phase: 'Phase',
        vectorGroup: 'Connection / Vector Group',
        groundingPreference: 'Grounding Preference',
        targetImpedance: 'Target Impedance (%Z)',
        noLoadLoss: 'No-Load Loss Guarantee (W)',
        loadLoss: 'Load Loss Guarantee (W)',
        temperatureRise: 'Temperature Rise',
        temperatureRiseOther: 'Temperature Rise (Other)',
        soundLevel: 'Sound Level Requirement',
        soundLimit: 'Sound Limit (dB(A))',
        tapChangerType: 'Tap Changer Type',
        tapRange: 'Tap Range',
        tapSteps: 'Tap Steps',
        tapLocation: 'Preferred Tap Location',
        hvBil: 'HV BIL (kV)',
        lvBil: 'LV BIL (kV)',
        surgeRequirements: 'Surge / Lightning Requirements',
        maxShippingWeight: 'Max Shipping Weight',
        maxHeight: 'Max Height',
        maxWidth: 'Max Width',
        maxLength: 'Max Length',
        seismicRating: 'Seismic Rating',
        siteFootprint: 'Site Footprint Constraints',
        coolingClass: 'Cooling Class',
        coolingRedundancy: 'Cooling Redundancy',
        oilType: 'Oil Type',
        oilTypeOther: 'Oil Type (Other)',
        corrosionClass: 'Corrosion / Paint Class',
        corrosionClassCustom: 'Corrosion Class (Custom)',
        noiseBarriers: 'Noise Barriers Required',
        altitude: 'Altitude Above Sea Level',
        maxAmbient: 'Max Ambient Temperature (°C)',
        minAmbient: 'Min Ambient Temperature (°C)',
        testing: 'Testing Requirements',
        partialDischargeLimit: 'Partial Discharge Limit (pC)',
        optionalUploads: 'Optional Uploads',
        governingStandards: 'Governing Standards',
        additionalNotes: 'Additional Notes',
        indicativeValue: 'Indicative Unit Value ($ million)'
      };

      // Section groupings
      const sections = [
        { title: '1. Basic Information', fields: ['companyName', 'projectName', 'siteAddress', 'contactName', 'contactEmail', 'contactPhone'] },
        { title: '2. Electrical Ratings', fields: ['hvRating', 'lvRating', 'mvaRating', 'frequency', 'phase', 'vectorGroup', 'groundingPreference'] },
        { title: '3. Impedance & Performance', fields: ['targetImpedance', 'noLoadLoss', 'loadLoss', 'temperatureRise', 'temperatureRiseOther', 'soundLevel', 'soundLimit'] },
        { title: '4. Tap Changer', fields: ['tapChangerType', 'tapRange', 'tapSteps', 'tapLocation'] },
        { title: '5. Dielectric Requirements', fields: ['hvBil', 'lvBil', 'surgeRequirements'] },
        { title: '6. Mechanical & Transport Limits', fields: ['maxShippingWeight', 'maxHeight', 'maxWidth', 'maxLength', 'seismicRating', 'siteFootprint'] },
        { title: '7. Cooling & Fluid System', fields: ['coolingClass', 'coolingRedundancy', 'oilType', 'oilTypeOther'] },
        { title: '8. Environmental & Special Requirements', fields: ['corrosionClass', 'corrosionClassCustom', 'noiseBarriers', 'altitude', 'maxAmbient', 'minAmbient'] },
        { title: '9. Testing Requirements', fields: ['testing', 'partialDischargeLimit', 'optionalUploads'] },
        { title: '10. Compliance', fields: ['governingStandards'] },
        { title: '11. Additional Notes', fields: ['additionalNotes'] },
        { title: 'Commercial Information', fields: ['indicativeValue'] }
      ];

      // Get submission ID from URL (supports both /review/abc123 and /review?id=abc123)
      const pathParts = window.location.pathname.split('/').filter(p => p);
      const urlParams = new URLSearchParams(window.location.search);
      let submissionId = urlParams.get('id');
      
      if (!submissionId) {
        // Try to get from path: /receive-instant-quote/review/abc123
        const reviewIndex = pathParts.indexOf('review');
        if (reviewIndex !== -1 && pathParts[reviewIndex + 1]) {
          submissionId = pathParts[reviewIndex + 1];
        }
      }

      // Load data from localStorage
      const data = localStorage.getItem('nbpo_' + submissionId);
      const container = document.getElementById('reviewContent');

      if (!data) {
        container.innerHTML = `
          <div class="not-found">
            <h2>Submission Not Found</h2>
            <p>We couldn't find a submission with ID: ${submissionId}</p>
            <a href="/receive-instant-quote" class="btn btn-edit">Start New Quote</a>
          </div>
        `;
      } else {
        const formData = JSON.parse(data);
        
        let html = `
          <div class="review-header">
            <h1 class="review-title">Review Your Submission</h1>
            <span class="review-id">ID: ${submissionId}</span>
          </div>
          
          <div class="review-actions">
            <a href="/receive-instant-quote/?edit=${submissionId}" class="btn btn-edit">
              ← Edit Submission
            </a>
            <button class="btn btn-confirm" onclick="confirmSubmission()">
              Submit Letter of Intent
            </button>
          </div>
        `;

        sections.forEach(section => {
          const hasValues = section.fields.some(field => {
            const val = formData[field];
            return val && (Array.isArray(val) ? val.length > 0 : val.toString().trim() !== '');
          });

          if (!hasValues) return;

          html += `
            <div class="review-section">
              <h2 class="review-section-title">${section.title}</h2>
              <div class="review-grid">
          `;

          section.fields.forEach(field => {
            const value = formData[field];
            if (!value || (Array.isArray(value) && value.length === 0)) return;
            
            const label = fieldLabels[field] || field;
            const isFullWidth = field === 'siteFootprint' || field === 'additionalNotes';
            
            let displayValue = '';
            if (Array.isArray(value)) {
              displayValue = value.map(v => `<span class="tag">${formatValue(v)}</span>`).join('');
            } else {
              displayValue = formatValue(value);
            }

            html += `
              <div class="review-item${isFullWidth ? ' full-width' : ''}">
                <span class="review-label">${label}</span>
                <div class="review-value${Array.isArray(value) ? ' list' : ''}${!displayValue ? ' empty' : ''}">
                  ${displayValue || 'Not specified'}
                </div>
              </div>
            `;
          });

          html += `
              </div>
            </div>
          `;
        });

        html += `
          <div class="review-actions" style="margin-top: 2rem; justify-content: center;">
            <a href="/receive-instant-quote/?edit=${submissionId}" class="btn btn-edit">
              ← Edit Submission
            </a>
            <button class="btn btn-confirm" onclick="confirmSubmission()">
              Submit Letter of Intent
            </button>
          </div>
        `;

        container.innerHTML = html;
      }

      function formatValue(val) {
        // Format common values for better display
        const formatMap = {
          '60Hz': '60 Hz',
          '50Hz': '50 Hz',
          '3-phase': '3-Phase (Standard)',
          'Δ-Y': 'Δ-Y',
          'Y-Δ': 'Y-Δ',
          'Y-Y': 'Y-Y',
          '55C': '55°C',
          '65C': '65°C',
          'standardIEEE': 'Standard IEEE',
          'lowNoise': 'Low-noise',
          'ultraLowNoise': 'Ultra-low-noise',
          'DETC': 'DETC (Off-circuit)',
          'OLTC': 'OLTC (On-load)',
          'HV': 'HV Side',
          'LV': 'LV Side',
          'noPreference': 'No Preference',
          'standard': 'Standard',
          'enhanced': 'Enhanced',
          'provideSurgeProfile': 'Will Provide Surge Profile',
          'zone2': 'Seismic Zone 2',
          'zone3': 'Seismic Zone 3',
          'zone4': 'Seismic Zone 4',
          'provideSiteSpec': 'Will Provide Site Seismic Spec',
          'ONAN': 'ONAN',
          'ONAF': 'ONAF',
          'OFAF': 'OFAF',
          'ODAF': 'ODAF',
          'N+1': 'N+1',
          'N+2': 'N+2',
          'mineralOil': 'Mineral Oil',
          'naturalEster': 'Natural Ester',
          'syntheticEster': 'Synthetic Ester',
          'standardInland': 'Standard Inland',
          'heavyIndustrial': 'Heavy Industrial',
          'coastalSaltFog': 'Coastal / Salt Fog',
          'yes': 'Yes',
          'no': 'No',
          'standardRoutine': 'Standard IEEE/IEC Routine Tests',
          'temperatureRise': 'Temperature-rise Test',
          'lightningImpulse': 'Lightning Impulse Test',
          'switchingSurge': 'Switching Surge Test',
          'FRA': 'FRA (Frequency Response Analysis)',
          'specialWitness': 'Special Witness Testing',
          'extendedHeatRun': 'Extended Heat Run',
          'zeroSequence': 'Zero-sequence Impedance',
          'partialDischarge': 'Partial Discharge Test',
          'utilitySpec': 'Utility Standard Specification',
          'testProcedures': 'Special Test Procedures',
          'IEEEC57': 'IEEE C57 (North America)',
          'IEC': 'IEC',
          'utilitySpecific': 'Utility-specific Standard'
        };
        
        return formatMap[val] || val;
      }

      function confirmSubmission() {
        const submissionData = JSON.parse(data);
        submissionData.submittedAt = new Date().toISOString();
        
        console.log('=== NBPO FORM SUBMISSION ===');
        console.log(JSON.stringify(submissionData, null, 2));
        console.log('============================');
        
        alert('Form submitted! Data logged to console.\n\nPress F12 or Cmd+Option+J to view.');
      }
    </script>
  </body>
</html>

